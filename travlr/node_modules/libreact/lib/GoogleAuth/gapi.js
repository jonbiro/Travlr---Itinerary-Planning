"use strict";
var _this = this;
Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
var gapiCache;
exports.getGapi = function () { return tslib_1.__awaiter(_this, void 0, void 0, function () {
    return tslib_1.__generator(this, function (_a) {
        switch (_a.label) {
            case 0:
                if (gapiCache) {
                    return [2, gapiCache];
                }
                return [4, new Promise(function (resolve) {
                        var gapicallback = "__gapicb" + Date.now().toString(36);
                        window[gapicallback] = function () {
                            delete window[gapicallback];
                            gapiCache = window.gapi;
                            resolve();
                        };
                        var script = document.createElement('script');
                        script.src = 'https://apis.google.com/js/platform.js?onload=' + gapicallback;
                        document.head.appendChild(script);
                    })];
            case 1:
                _a.sent();
                return [2, gapiCache];
        }
    });
}); };
var gapiAuth2Cache;
exports.getGapiAuth2 = function () { return tslib_1.__awaiter(_this, void 0, void 0, function () {
    var gapi;
    return tslib_1.__generator(this, function (_a) {
        switch (_a.label) {
            case 0:
                if (gapiAuth2Cache) {
                    return [2, gapiAuth2Cache];
                }
                return [4, exports.getGapi()];
            case 1:
                gapi = _a.sent();
                return [4, new Promise(function (resolve) {
                        gapi.load('auth2', function () {
                            gapiAuth2Cache = gapi.auth2;
                            resolve();
                        });
                    })];
            case 2:
                _a.sent();
                return [2, gapiAuth2Cache];
        }
    });
}); };
exports.getGapiAuthInstance = function (options) { return tslib_1.__awaiter(_this, void 0, void 0, function () {
    var gapiAuth2;
    return tslib_1.__generator(this, function (_a) {
        switch (_a.label) {
            case 0: return [4, exports.getGapiAuth2()];
            case 1:
                gapiAuth2 = _a.sent();
                return [4, gapiAuth2.init(options)];
            case 2: return [2, _a.sent()];
        }
    });
}); };
//# sourceMappingURL=gapi.js.map