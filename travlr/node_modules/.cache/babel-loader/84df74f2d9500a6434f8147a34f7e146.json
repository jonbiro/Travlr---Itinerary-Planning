{"ast":null,"code":"import _toConsumableArray from \"/Users/yoni/Development/travlrbackend2/travlr/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _classCallCheck from \"/Users/yoni/Development/travlrbackend2/travlr/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/yoni/Development/travlrbackend2/travlr/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/yoni/Development/travlrbackend2/travlr/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/yoni/Development/travlrbackend2/travlr/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/yoni/Development/travlrbackend2/travlr/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/yoni/Development/travlrbackend2/travlr/src/BestComponents/CityShow.js\";\nimport React, { Component } from \"react\";\nimport { ROOT_URL } from \"../Config\";\nimport axios from \"axios\";\nimport { withRouter } from \"react-router-dom\";\nimport \"./map.css\";\nimport CityItinerary from \"./CityItinerary\";\n\nvar CityShow =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(CityShow, _Component);\n\n  function CityShow() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, CityShow);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(CityShow)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _this.state = {\n      city: {\n        name: null\n      },\n      venues: [],\n      searchTerm: \"attraction\",\n      success: \"\",\n      places: [],\n      showButton: false\n    };\n\n    _this.fetchCity = function () {\n      // let poo = window.location.pathname.split(\"/\");\n      // let poop = parseInt(poo.slice(poo.length - 1));\n      var id = parseInt(_this.props.match.params.id);\n\n      if (_this.state.city.name === null) {\n        fetch(\"/api/v1/cities/\".concat(id), {\n          method: \"GET\",\n          headers: {\n            // Accept: \"application/json\",\n            \"Content-Type\": \"application/json\",\n            Authorization: \"Bearer \".concat(localStorage.getItem(\"accessToken\"))\n          }\n        }).then(function (res) {\n          return res.json();\n        }).then(function (json) {\n          _this.setState({\n            city: json,\n            places: json.places\n          });\n        }).then(_this.getVenues);\n      }\n    };\n\n    _this.renderMap = function () {\n      loadScript(\"https://maps.googleapis.com/maps/api/js?key=AIzaSyD1DrDBUd6GNL2EIBCxK-K0OjkTny8kbuA&&libraries=places&callback=initMap\");\n      window.initMap = _this.initMap;\n    };\n\n    _this.getVenues = function (query) {\n      var endPoint = \"https://api.foursquare.com/v2/venues/explore?\";\n      var parameters = {\n        client_id: \"PMHC2WA1VCBHVYOPPSJ0QSBYTLRF4PNJ04OWVWV0PZJ0QFIR\",\n        client_secret: \"CULSZZ44YAEBOWBFGPB4BF5ISRXXSNYR0EE3JV3CNE2ZWHV0\",\n        section: \"sights\",\n        near: _this.state.city.name,\n        v: \"20192503\"\n      };\n      axios.get(endPoint + new URLSearchParams(parameters)).then(function (response) {\n        // console.log(\"response\" + response);\n        // if (response.includes('warning')){console.log ('hey!!!')}\n        // debugger\n        _this.setState({\n          venues: response.data.response.groups[0].items,\n          searchTerm: query\n        }, _this.renderMap());\n      }).catch(function (error) {\n        console.log(\"ERROR!! \" + error);\n      });\n    };\n\n    _this.getVenuesSearch = function (query) {\n      var po = _this.state.venues;\n      var endPoint = \"https://api.foursquare.com/v2/venues/explore?\";\n      var parameters = {\n        client_id: \"PMHC2WA1VCBHVYOPPSJ0QSBYTLRF4PNJ04OWVWV0PZJ0QFIR\",\n        client_secret: \"CULSZZ44YAEBOWBFGPB4BF5ISRXXSNYR0EE3JV3CNE2ZWHV0\",\n        query: query || \"food\",\n        near: _this.state.city.name,\n        v: \"20192503\"\n      };\n      axios.get(endPoint + new URLSearchParams(parameters)).then(function (response) {\n        // console.log(\"response\" + response);\n        if (response.data.response.groups[0].items.length > 0) {\n          _this.setState({\n            venues: response.data.response.groups[0].items,\n            searchTerm: query\n          }, _this.renderMap());\n        } else {\n          _this.setState({\n            venues: po\n          });\n        }\n      });\n    };\n\n    _this.saveFunc = function (lat, lng, name) {\n      //problem is that i dont have access to props so I can't set the relationship required trip_id to this.props.trip.id\n      // also can't do this.props.history.push(\"/trips\");\n      // console.log(this);\n      // let poo = window.location.pathname.split(\"/\");\n      // let poop = parseInt(poo.slice(poo.length - 1));\n      var data = {\n        trip_id: _this.state.city.trip_id,\n        lat: lat,\n        lng: lng,\n        name: name,\n        city_id: _this.state.city.id\n      };\n      fetch(\"/api/v1/places\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Authorization: \"Bearer \".concat(localStorage.getItem(\"accessToken\"))\n        },\n        body: JSON.stringify(data)\n      }).then(function (res) {\n        return res.json();\n      }).then(function (json) {\n        return (// console.log(\"poo\" + json) ||\n          _this.setState({\n            places: [].concat(_toConsumableArray(_this.state.places), [json])\n          })\n        );\n      });\n    };\n\n    _this.initMap = function () {\n      var centerPoint = _this.state.venues[0].venue.location || {\n        lat: 40.7128,\n        lng: -74.006\n      }; // Create A Map\n\n      window.map = new window.google.maps.Map(document.getElementById(\"map\"), {\n        center: centerPoint,\n        zoom: 12\n      }); // Create An InfoWindow\n\n      var infowindow = new window.google.maps.InfoWindow();\n      window.google.maps.event.addListener(infowindow, \"domready\", function () {\n        document.getElementById(\"saveBtn\").addEventListener(\"click\", function (e) {\n          _this.saveFunc(e.target.dataset.lat, e.target.dataset.lng, e.target.dataset.name);\n        });\n      }); // Display Dynamic Markers // I should use forEach instead of map\n\n      _this.state.venues.forEach(function (myVenue) {\n        var contentString = \"\".concat(myVenue.venue.name, \" <br> \").concat(myVenue.venue.categories[0].name, \" <br>\"); // Create A Marker\n        //   console.log(myVenue.venue.location.lat)\n\n        var marker = new window.google.maps.Marker({\n          position: {\n            lat: myVenue.venue.location.lat,\n            lng: myVenue.venue.location.lng\n          },\n          map: window.map,\n          title: myVenue.venue.name\n        }); // Click on A Marker!\n\n        marker.addListener(\"click\", function () {\n          // Change the content\n          infowindow.setContent(\"<div id='myInfoWinDiv'>\\n            \".concat(contentString, \"\\n            <button\\n            \\tdata-lat=\\\"\").concat(myVenue.venue.location.lat, \"\\\"\\n            \\tdata-lng=\\\"\").concat(myVenue.venue.location.lng, \"\\\"\\n            \\tdata-name=\\\"\").concat(myVenue.venue.name, \"\\\"\\n            \\tid=\\\"saveBtn\\\">Save</button>\\n            </div>\")); // Open An InfoWindow\n\n          infowindow.open(window.map, marker);\n        });\n      });\n    };\n\n    _this.searchInputFS = function (e) {\n      e.preventDefault();\n\n      _this.getVenuesSearch(e.target.name.value);\n    };\n\n    _this.deletePlace = function (place) {\n      var deletedObjFilter = _this.state.places.filter(function (placeObj) {\n        return place.id !== placeObj.id;\n      });\n\n      fetch(\"/api/v1/places/\".concat(place.id), {\n        method: \"delete\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Authorization: \"Bearer \".concat(localStorage.getItem(\"accessToken\"))\n        }\n      }).then(function () {\n        return _this.setState({\n          places: deletedObjFilter,\n          showButton: !_this.state.showButton\n        });\n      });\n    };\n\n    _this.deleteButton = function () {\n      _this.setState({\n        showButton: !_this.state.showButton\n      });\n    };\n\n    return _this;\n  }\n\n  _createClass(CityShow, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.fetchCity();\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 215\n        },\n        __self: this\n      }, React.createElement(\"h1\", {\n        className: \"bigh1\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 216\n        },\n        __self: this\n      }, this.state.city.name), React.createElement(\"form\", {\n        onSubmit: this.searchInputFS,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 218\n        },\n        __self: this\n      }, React.createElement(\"label\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 219\n        },\n        __self: this\n      }, \"Search for something to do/eat in \", this.state.city.name, \":\", \"   \", React.createElement(\"input\", {\n        type: \"text\",\n        name: \"name\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 221\n        },\n        __self: this\n      })), \"   \", React.createElement(\"input\", {\n        type: \"submit\",\n        value: \"Submit\",\n        className: \"navitem poo\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 224\n        },\n        __self: this\n      })), React.createElement(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 226\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        id: \"cityshow\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 227\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        id: \"map\",\n        className: \"fade\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 228\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        id: \"itinerary\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 229\n        },\n        __self: this\n      }, React.createElement(CityItinerary, {\n        places: this.state.places,\n        deletePlace: this.deletePlace,\n        showDelete: this.state.showButton,\n        deleteButton: this.deleteButton,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 230\n        },\n        __self: this\n      }))));\n    }\n  }]);\n\n  return CityShow;\n}(Component);\n\nfunction loadScript(url) {\n  var index = window.document.getElementsByTagName(\"script\")[0];\n  var script = window.document.createElement(\"script\");\n  script.src = url;\n  script.async = true;\n  script.defer = true;\n  index.parentNode.insertBefore(script, index);\n}\n\nexport default withRouter(CityShow);","map":{"version":3,"sources":["/Users/yoni/Development/travlrbackend2/travlr/src/BestComponents/CityShow.js"],"names":["React","Component","ROOT_URL","axios","withRouter","CityItinerary","CityShow","state","city","name","venues","searchTerm","success","places","showButton","fetchCity","id","parseInt","props","match","params","fetch","method","headers","Authorization","localStorage","getItem","then","res","json","setState","getVenues","renderMap","loadScript","window","initMap","query","endPoint","parameters","client_id","client_secret","section","near","v","get","URLSearchParams","response","data","groups","items","catch","error","console","log","getVenuesSearch","po","length","saveFunc","lat","lng","trip_id","city_id","body","JSON","stringify","centerPoint","venue","location","map","google","maps","Map","document","getElementById","center","zoom","infowindow","InfoWindow","event","addListener","addEventListener","e","target","dataset","forEach","myVenue","contentString","categories","marker","Marker","position","title","setContent","open","searchInputFS","preventDefault","value","deletePlace","place","deletedObjFilter","filter","placeObj","deleteButton","url","index","getElementsByTagName","script","createElement","src","async","defer","parentNode","insertBefore"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { ROOT_URL } from \"../Config\";\nimport axios from \"axios\";\nimport { withRouter } from \"react-router-dom\";\nimport \"./map.css\";\nimport CityItinerary from \"./CityItinerary\";\n\nclass CityShow extends Component {\n  state = {\n    city: {\n      name: null\n    },\n    venues: [],\n    searchTerm: \"attraction\",\n    success: \"\",\n    places: [],\n\t  showButton: false\n  };\n\n  componentDidMount() {\n    this.fetchCity();\n  }\n\n  fetchCity = () => {\n    // let poo = window.location.pathname.split(\"/\");\n    // let poop = parseInt(poo.slice(poo.length - 1));\n    let id = parseInt(this.props.match.params.id);\n    if (this.state.city.name === null) {\n      fetch(`/api/v1/cities/${id}`, {\n        method: \"GET\",\n        headers: {\n          // Accept: \"application/json\",\n          \"Content-Type\": \"application/json\",\n          Authorization: `Bearer ${localStorage.getItem(\"accessToken\")}`\n        }\n      })\n        .then(res => res.json())\n        .then(json => {\n          this.setState({\n            city: json,\n            places: json.places\n          });\n        })\n        .then(this.getVenues);\n    }\n  };\n\n  renderMap = () => {\n    loadScript(\n      \"https://maps.googleapis.com/maps/api/js?key=AIzaSyD1DrDBUd6GNL2EIBCxK-K0OjkTny8kbuA&&libraries=places&callback=initMap\"\n    );\n    window.initMap = this.initMap;\n  };\n\n  getVenues = query => {\n    const endPoint = \"https://api.foursquare.com/v2/venues/explore?\";\n    const parameters = {\n      client_id: \"PMHC2WA1VCBHVYOPPSJ0QSBYTLRF4PNJ04OWVWV0PZJ0QFIR\",\n      client_secret: \"CULSZZ44YAEBOWBFGPB4BF5ISRXXSNYR0EE3JV3CNE2ZWHV0\",\n      section: \"sights\",\n      near: this.state.city.name,\n      v: \"20192503\"\n    };\n    axios\n      .get(endPoint + new URLSearchParams(parameters))\n      .then(response => {\n        // console.log(\"response\" + response);\n        // if (response.includes('warning')){console.log ('hey!!!')}\n        // debugger\n        this.setState(\n          {\n            venues: response.data.response.groups[0].items,\n            searchTerm: query\n          },\n          this.renderMap()\n        );\n      })\n      .catch(error => {\n        console.log(\"ERROR!! \" + error);\n      });\n  };\n\n  getVenuesSearch = query => {\n\t  let po =this.state.venues\n    const endPoint = \"https://api.foursquare.com/v2/venues/explore?\";\n    const parameters = {\n      client_id: \"PMHC2WA1VCBHVYOPPSJ0QSBYTLRF4PNJ04OWVWV0PZJ0QFIR\",\n      client_secret: \"CULSZZ44YAEBOWBFGPB4BF5ISRXXSNYR0EE3JV3CNE2ZWHV0\",\n      query: query || \"food\",\n      near: this.state.city.name,\n      v: \"20192503\"\n    };\n    axios.get(endPoint + new URLSearchParams(parameters)).then(response => {\n      // console.log(\"response\" + response);\n      if (response.data.response.groups[0].items.length > 0) {\n        this.setState(\n          {\n            venues: response.data.response.groups[0].items,\n            searchTerm: query\n          },\n          this.renderMap()\n        );\n      }else {this.setState({venues: po})}\n    });\n  };\n\n  saveFunc = (lat, lng, name) => {\n    //problem is that i dont have access to props so I can't set the relationship required trip_id to this.props.trip.id\n    // also can't do this.props.history.push(\"/trips\");\n    // console.log(this);\n    // let poo = window.location.pathname.split(\"/\");\n    // let poop = parseInt(poo.slice(poo.length - 1));\n    let data = {\n      trip_id: this.state.city.trip_id,\n      lat: lat,\n      lng: lng,\n      name: name,\n      city_id: this.state.city.id\n    };\n    fetch(\"/api/v1/places\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Authorization: `Bearer ${localStorage.getItem(\"accessToken\")}`\n      },\n      body: JSON.stringify(data)\n    })\n      .then(res => res.json())\n      .then(\n        json =>\n          // console.log(\"poo\" + json) ||\n          this.setState({ places: [...this.state.places, json] })\n      );\n  };\n\n  initMap = () => {\n    const centerPoint = this.state.venues[0].venue.location || {\n      lat: 40.7128,\n      lng: -74.006\n    };\n    // Create A Map\n    window.map = new window.google.maps.Map(document.getElementById(\"map\"), {\n      center: centerPoint,\n      zoom: 12\n    });\n    // Create An InfoWindow\n    let infowindow = new window.google.maps.InfoWindow();\n\n    window.google.maps.event.addListener(infowindow, \"domready\", () => {\n      document.getElementById(\"saveBtn\").addEventListener(\"click\", e => {\n        this.saveFunc(\n          e.target.dataset.lat,\n          e.target.dataset.lng,\n          e.target.dataset.name\n        );\n      });\n    });\n    // Display Dynamic Markers // I should use forEach instead of map\n    this.state.venues.forEach(myVenue => {\n      let contentString = `${myVenue.venue.name} <br> ${\n        myVenue.venue.categories[0].name\n      } <br>`;\n\n      // Create A Marker\n      //   console.log(myVenue.venue.location.lat)\n      let marker = new window.google.maps.Marker({\n        position: {\n          lat: myVenue.venue.location.lat,\n          lng: myVenue.venue.location.lng\n        },\n        map: window.map,\n        title: myVenue.venue.name\n      });\n\n      // Click on A Marker!\n      marker.addListener(\"click\", function() {\n        // Change the content\n        infowindow.setContent(\n          `<div id='myInfoWinDiv'>\n            ${contentString}\n            <button\n            \tdata-lat=\"${myVenue.venue.location.lat}\"\n            \tdata-lng=\"${myVenue.venue.location.lng}\"\n            \tdata-name=\"${myVenue.venue.name}\"\n            \tid=\"saveBtn\">Save</button>\n            </div>`\n        );\n        // Open An InfoWindow\n        infowindow.open(window.map, marker);\n      });\n    });\n  };\n\n  searchInputFS = e => {\n    e.preventDefault();\n    this.getVenuesSearch(e.target.name.value);\n  };\n\n\tdeletePlace = place => {\n\t\tlet deletedObjFilter =this.state.places.filter(placeObj => place.id !== placeObj.id);\n\t\tfetch(`/api/v1/places/${place.id}`, {\n\t\t\tmethod: \"delete\",\n\t\t\theaders: {\n\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\tAuthorization: `Bearer ${localStorage.getItem(\"accessToken\")}`\n\t\t\t}}).then(() =>this.setState({\n\t\t\tplaces: deletedObjFilter, showButton: !this.state.showButton\n\t\t}))\n\t};\ndeleteButton = () => {\n\tthis.setState({showButton: !this.state.showButton})\n}\n  render() {\n    return (\n      <div>\n        <h1 className='bigh1'>{this.state.city.name}</h1>\n\n        <form onSubmit={this.searchInputFS}>\n          <label >\n            Search for something to do/eat in {this.state.city.name}:{\"   \"}\n            <input type=\"text\" name=\"name\" />\n          </label>\n          {\"   \"}\n          <input type=\"submit\" value=\"Submit\" className=\"navitem poo\" />\n        </form>\n        <br />\n        <div id=\"cityshow\">\n          <div id=\"map\" className=\"fade\" />\n          <div id=\"itinerary\">\n            <CityItinerary places={this.state.places} deletePlace={this.deletePlace} showDelete={this.state.showButton} deleteButton={this.deleteButton}/>\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nfunction loadScript(url) {\n  let index = window.document.getElementsByTagName(\"script\")[0];\n  let script = window.document.createElement(\"script\");\n  script.src = url;\n  script.async = true;\n  script.defer = true;\n  index.parentNode.insertBefore(script, index);\n}\n\nexport default withRouter(CityShow);\n"]},"metadata":{},"sourceType":"module"}